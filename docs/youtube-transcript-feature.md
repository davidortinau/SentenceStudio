# YouTube Transcript Feature Implementation

## Overview

Implemented a complete YouTube transcript fetching and display feature for the YouTubeImportPage with intelligent language-aware selection based on user preferences.

## Implementation Date

October 5, 2025

## Features Implemented

### 1. Service Layer Enhancements (`YouTubeImportService.cs`)

#### New Model Class: `TranscriptTrack`

```csharp
public class TranscriptTrack
{
    public string LanguageCode { get; set; }       // ISO language code (e.g., "ko", "en")
    public string LanguageName { get; set; }       // Human-readable name (e.g., "Korean", "English")
    public bool IsAutoGenerated { get; set; }      // Whether transcript is auto-generated or manual
    public ClosedCaptionTrackInfo TrackInfo { get; set; }  // YoutubeExplode track info
}
```

#### New Service Methods

**`GetAvailableTranscriptsAsync(string videoUrl)`**

- Fetches all available closed caption/subtitle tracks for a YouTube video
- Returns a list of `TranscriptTrack` objects with metadata
- Uses YoutubeExplode's `Videos.ClosedCaptions.GetManifestAsync()` API

**`DownloadTranscriptTextAsync(TranscriptTrack track)`**

- Downloads the full transcript text from a specific track
- Concatenates all caption segments into a single text block
- Returns plain text format for easy display and processing

### 2. UI State Management (`YouTubeImportState`)

Added transcript-related properties:

- `List<TranscriptTrack> AvailableTranscripts` - All discovered transcripts
- `TranscriptTrack SelectedTranscript` - Currently selected transcript
- `string TranscriptText` - Full downloaded transcript text
- `bool IsLoadingTranscripts` - Loading state indicator
- `bool ShowTranscriptPicker` - Controls picker visibility
- `string TranscriptMessage` - User-facing status messages

### 3. User Interface Enhancements (`YouTubeImportPage.cs`)

#### New UI Elements

**Fetch Transcripts Button**

- Placed next to "Import Clip" button in HStack
- Enabled when video URL is provided
- Initiates transcript discovery process

**Status Messages**

- `TranscriptMessage` label shows discovery and loading status
- Provides feedback like "Found 3 transcripts" or "Loading Korean transcript..."

**Language Picker** (shown when multiple transcripts available)

- Dropdown list of available transcript languages
- Shows language names in human-readable format
- Displays auto-generated vs manual indicator
- Pre-selects user's preferred language

**Transcript Display**

- ScrollView with 200px height
- Bordered container for clear visual separation
- Full transcript text with proper padding
- Appears only when transcript is loaded

### 4. Smart Language Selection Logic

#### Priority Order

1. **Target Language** (e.g., Korean for language learners) - highest priority
2. **Native Language** (e.g., English) - fallback
3. **First Available** - last resort

#### Automatic Behavior

**Single Transcript**: Automatically loads and displays immediately

**Multiple Transcripts**:

- Pre-selects based on user's target language preference
- Shows picker for manual language switching
- Auto-loads the preferred transcript
- User can switch languages via picker

#### Language Code Mapping

Supports major languages with ISO 639-1 codes:

- Korean â†’ "ko"
- English â†’ "en"  
- Spanish â†’ "es"
- Japanese â†’ "ja"
- Chinese â†’ "zh"
- French â†’ "fr"
- German â†’ "de"
- Italian â†’ "it"
- Portuguese â†’ "pt"
- Russian â†’ "ru"

### 5. User Profile Integration

**Dependencies**:

- Injects `UserProfileRepository` to access user preferences
- Reads `NativeLanguage` and `TargetLanguage` from profile
- No hard-coded language assumptions

**Language Detection**:

- Uses `GetLanguageCode()` helper method to convert language names to ISO codes
- Gracefully handles missing profile (defaults to Korean/English)

## Technical Details

### YoutubeExplode API Usage

```csharp
// Get available transcripts
var trackManifest = await _youtubeClient.Videos.ClosedCaptions.GetManifestAsync(videoId);

// Iterate through tracks
foreach (var trackInfo in trackManifest.Tracks)
{
    // Access properties: Language.Code, Language.Name, IsAutoGenerated
}

// Download transcript content
var track = await _youtubeClient.Videos.ClosedCaptions.GetAsync(trackInfo);
foreach (var caption in track.Captions)
{
    // caption.Text contains the transcript segment
}
```

### Error Handling

All transcript operations are wrapped in try-catch blocks:

- Network failures â†’ Display error message
- No transcripts available â†’ Inform user
- API changes â†’ Graceful degradation

## User Workflow

1. **Enter YouTube URL** in the video URL field
2. **Click "Fetch Transcripts"** button
3. **System discovers** available transcript languages
4. **Auto-selection** occurs based on user's target language (Korean)
5. **Transcript loads** automatically
6. **User can switch** languages via picker if multiple available
7. **Transcript displays** in scrollable text area

## Future Enhancements (Planned)

### Phase 4: Save as Learning Resource

- "Save Transcript" button
- Store transcript in `LearningResource` table
- Link to video metadata (title, URL)
- Make available for other learning activities

### Potential Features

- Timestamp preservation for synced playback
- Search within transcript
- Export transcript to file
- Highlight vocabulary words in transcript
- Link transcript segments to audio timeline

## Benefits

âœ… **No YouTube API Key Required** - Uses YoutubeExplode's web scraping approach  
âœ… **Works with Any Public Video** - Not limited to owned content  
âœ… **Language-Aware** - Automatically selects learner's target language  
âœ… **Supports Auto-Generated** - Works with both manual and auto-generated captions  
âœ… **User-Friendly** - Simple one-click operation with smart defaults  
âœ… **Flexible** - Easy to extend for future features like timestamps

## Files Modified

1. `/Services/YouTubeImportService.cs` - Added transcript fetching methods
2. `/Pages/Shadowing/YouTubeImportPage.cs` - Added UI and logic for transcripts

## Testing Notes

- Test with videos that have multiple language options
- Test with videos that only have auto-generated captions
- Test with videos without any captions
- Verify language preference detection works correctly
- Check UI responsiveness during loading

## Dependencies

- **YoutubeExplode** (existing) - v6.4.4 or later
- **YoutubeExplode.Videos.ClosedCaptions** namespace (added)

No new NuGet packages required! ðŸŽ‰
